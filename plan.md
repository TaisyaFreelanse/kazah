# План разработки приложения "Blim Bilem"

## Архитектура приложения

```mermaid
flowchart TB
    subgraph UI [UI Layer]
        MainMenu[Главное меню]
        GameScreen[Экран игры]
        PackagesScreen[Экран пакетов]
        ResultScreen[Экран результата]
    end
    
    subgraph Logic [Business Logic]
        GameController[GameController]
        QuestionService[QuestionService]
        TimerService[TimerService]
        LanguageService[LanguageService]
        PurchaseService[PurchaseService]
    end
    
    subgraph Data [Data Layer]
        ExcelParser[Excel Parser]
        LocalStorage[SharedPreferences]
        Assets[Assets - Excel files]
    end
    
    MainMenu --> GameController
    GameScreen --> GameController
    GameController --> QuestionService
    GameController --> TimerService
    QuestionService --> ExcelParser
    ExcelParser --> Assets
    LanguageService --> LocalStorage
    PurchaseService --> LocalStorage
```



## Структура проекта

```javascript
blim_bilem/
├── lib/
│   ├── main.dart
│   ├── app.dart
│   ├── screens/
│   │   ├── main_menu_screen.dart
│   │   ├── game_screen.dart
│   │   ├── packages_screen.dart
│   │   ├── result_screen.dart
│   │   └── timeout_screen.dart
│   ├── widgets/
│   │   ├── language_button.dart
│   │   ├── menu_button.dart
│   │   ├── answer_button.dart
│   │   ├── timer_widget.dart
│   │   └── package_badge.dart
│   ├── models/
│   │   ├── question.dart
│   │   └── package_info.dart
│   ├── services/
│   │   ├── question_service.dart
│   │   ├── language_service.dart
│   │   ├── timer_service.dart
│   │   ├── excel_parser.dart
│   │   └── purchase_service.dart
│   ├── providers/
│   │   ├── game_provider.dart
│   │   └── language_provider.dart
│   └── constants/
│       ├── colors.dart
│       └── strings.dart
├── assets/
│   ├── data/
│   │   ├── questions_kz.xlsx
│   │   ├── questions_ru.xlsx
│   │   ├── phrases_kz.xlsx
│   │   └── history_kz.xlsx
│   └── images/
│       ├── trophy.png
│       └── medal.png
└── pubspec.yaml
```



## Этапы разработки

### Этап 1: Базовая настройка проекта

- [x] Создание Flutter проекта
- [x] Настройка зависимостей в `pubspec.yaml`:
- [x] `excel` - парсинг Excel файлов
- [x] `provider` - state management
- [x] `shared_preferences` - хранение настроек
- [x] `in_app_purchase` - покупки
- [x] `google_fonts` - шрифты
- [x] Копирование Excel файлов в `assets/data/`
- [x] Настройка структуры папок

### Этап 2: Парсер Excel и модели данных

- [x] Модель `Question`:
  ```dart
                        class Question {
                          final String text;
                          final List<String> answers; // 6 вариантов
                          final int correctAnswerIndex; // всегда 0 в исходных данных
                          final Difficulty difficulty; // easy, medium, hard
                          final String? packageId; // null для базовых вопросов
                        }
  ```

- [x] Сервис `ExcelParser` для чтения вопросов из assets
- [x] Структура Excel: 3 листа (простые/средние/сложные), правильный ответ всегда первый
- [x] Метод `parsePhrases` для парсинга мотивирующих фраз

### Этап 3: Сервис локализации

- [x] `LanguageService` с поддержкой KZ/RU
- [x] Сохранение выбора в SharedPreferences
- [x] Казахский язык по умолчанию
- [x] Строковые константы:

| Ключ | Казахский | Русский ||------|-----------|---------|| start | СТАРТ ОЙЫН | СТАРТ ИГРЫ || additional_questions | ҚОСЫМША СҰРАҚТАР | ДОПОЛНИТЕЛЬНЫЕ ВОПРОСЫ || exit_game | ОЙЫННАН ШЫҒУ | ВЫХОД ИЗ ИГРЫ || more_questions | Көбірек сұрақтар | Больше вопросов || history | Қазақстан тарихы | История Казахстана || timeout_message | Ты не успел. Попробуй еще раз | К сожалению, ты не успел ответить || restart | ҚАЙТА БАСТАУ | НАЧАТЬ ЗАНОВО || main_menu | БАСТЫ МӘЗІРГЕ | В ГЛАВНОЕ МЕНЮ |
- [x] `LanguageProvider` для state management

### Этап 4: Главное меню

- [x] Заголовок "BLIM BILEM" с трофеем и лампочкой
- [x] Кнопка СТАРТ (зеленая, крупная)
- [x] Кнопки KZ/RU (синяя/красная, крупные, рядом)
- [x] Кнопка "Дополнительные вопросы" (синяя)
- [x] Кнопка "Выход" (оранжевая)
- [x] Градиентный фон (голубой к желтому)
- [x] Стиль кнопок: закругленные, с тенью, 3D-эффект
- [x] Интеграция с LanguageProvider для динамической локализации
- [x] Навигация на экраны игры и пакетов

### Этап 5: Игровой экран

- [x] Таймер 13 секунд сверху (визуально заметный)
- [x] Текст вопроса по центру
- [x] 6 кнопок ответов под вопросом
- [x] Значок пакета рядом с вопросом (если из пакета)
- [x] Логика рандомизации ответов (правильный ответ перемешивается)
- [x] Интеграция с TimerService
- [x] Интеграция с GameProvider
- [x] Обработка выбора ответа
- [x] Навигация на экраны результата и timeout

### Этап 6: Логика игры

- [x] Выборка 13 вопросов: 4 простых + 6 средних + 3 сложных
- [x] Рандомизация из общего пула (базовые + купленные пакеты)
- [x] Перемешивание вариантов ответов
- [x] Проверка правильности ответа
- [x] Переход к следующему вопросу или результату
- [x] Интеграция QuestionService с GameScreen
- [x] Загрузка вопросов по выбранному языку

### Этап 7: Подсказки в игре (3 вида)

- [x] Подсказка 1 — Проверка ответа:
  - Игрок может выбрать любой вариант ответа
  - Если ответ неверный:
    - Выбранный вариант подсвечивается красным
    - Отображается текст "Неверно" вместо текста варианта
    - Подсветка и текст показываются 2 секунды
    - Затем вариант ответа возвращается в исходное состояние
  - Если ответ верный:
    - Выбранный вариант подсвечивается зеленым
    - Отображается текст "Верно" вместо текста варианта
    - Подсветка и текст показываются 2 секунды
    - После этого игра продолжается
  - Подсказка не завершает игру и используется только для проверки

- [x] Подсказка 2 — 50/50:
  - При активации подсказки:
    - 3 неверных ответа выбираются случайным образом
    - Выбранные ответы:
      - Становятся некликабельными
      - Текст ответа исчезает
    - Оставшиеся варианты ответа продолжают работать
    - Правильный ответ никогда не скрывается

- [x] Подсказка 3 — Замена вопроса:
  - При активации подсказки:
    - Текущий вопрос полностью заменяется на другой
    - Новый вопрос выбирается из того же уровня сложности
    - Таймер сбрасывается и запускается заново
    - Номер вопроса сохраняется (например, был 5-й вопрос — остается 5-м)
  - Замена вопроса не влияет на общий прогресс игры

- [x] UI для активации подсказок (кнопки/иконки)
- [x] Логика управления использованием подсказок
- [x] Расширение AnswerButton для поддержки различных состояний
- [x] Интеграция подсказок с GameProvider и QuestionService

### Этап 8: Таймер и экран "Время вышло"

- [x] Обратный отсчет 13 секунд (реализован в TimerService)
- [x] При истечении: экран с сообщением (TimeoutScreen)
- [x] Кнопки: "Начать заново" / "В главное меню"
- [x] Интеграция с локализацией (KZ/RU)
- [x] Сброс состояния игры при переходе

### Этап 9: Экран победы

- [x] Золотой кубок/медаль (иконка трофея)
- [x] Случайная мотивирующая фраза из Excel
- [x] Кнопки продолжения ("Начать заново" / "В главное меню")
- [x] Интеграция с локализацией (KZ/RU)
- [x] Загрузка фраз из phrases_kz.xlsx

### Этап 10: Экран дополнительных пакетов

- [x] Список пакетов с цветовыми значками:
  - [x] "Больше вопросов" (фиолетовый цвет)
  - [x] "История Казахстана" (коричневый цвет)
- [x] Статус: куплен / не куплен
- [x] Кнопка покупки (заглушка, реальная покупка будет на этапе 11)
- [x] Интеграция с локализацией (KZ/RU)
- [x] Отображение статуса покупки (галочка для купленных)
- [x] Навигация назад в главное меню

### Этап 11: In-App Purchase интеграция

- [x] Настройка `in_app_purchase` пакета (уже добавлен в pubspec.yaml)
- [x] Инициализация InAppPurchase и проверка доступности
- [x] Загрузка продуктов через queryProductDetails
- [x] Обработка покупок через purchaseStream
- [x] Покупка non-consumable продуктов через buyNonConsumable
- [x] Восстановление покупок через restorePurchases
- [x] Сохранение статуса покупок локально (SharedPreferences)
- [x] Обработка статусов покупок (pending, purchased, restored, error)
- [x] Завершение покупок через completePurchase
- [x] Интеграция с PackagesScreen
- [x] UI для восстановления покупок
- [ ] Конфигурация продуктов в App Store / Google Play (требует настройки в магазинах)

### Этап 12: Админ-панель

#### 12.1 Общая структура админ-панели

- [ ] Создание экрана входа в админ-панель (авторизация)
- [ ] Главный экран админ-панели с тремя разделами:
  - [ ] **Общедоступные** - управление основным пулом вопросов
  - [ ] **Пакетные** - управление платными пакетами
  - [ ] **ФинФразы** - управление финальными мотивирующими фразами
- [ ] Навигация между разделами (кликабельные окна)
- [ ] Система авторизации администратора
- [ ] Возможность смены пароля администратора

#### 12.2 Раздел «Общедоступные»

- [ ] Два блока загрузки Excel:
  - [ ] Excel на казахском языке
  - [ ] Excel на русском языке
- [ ] Для каждого блока:
  - [ ] Кнопка «Загрузить Excel» (file picker)
  - [ ] Кнопка «Удалить файл» (с подтверждением действия)
  - [ ] Индикатор загруженного файла (название/размер)
- [ ] Логика загрузки:
  - [ ] Новый файл полностью заменяет предыдущий
  - [ ] Данные автоматически применяются в игре
  - [ ] Обновление приложения не требуется
  - [ ] Загруженный файл нельзя скачать

#### 12.3 Раздел «ФинФразы»

- [ ] Два блока загрузки Excel:
  - [ ] Excel на казахском языке
  - [ ] Excel на русском языке
- [ ] Для каждого блока:
  - [ ] Кнопка «Загрузить Excel»
  - [ ] Кнопка «Удалить файл» (с подтверждением)
  - [ ] Индикатор загруженного файла
- [ ] Структура Excel:
  - [ ] Одна колонка — текст фразы
- [ ] Логика применения:
  - [ ] Фразы выбираются рандомно при победе
  - [ ] Применяются без обновления приложения
  - [ ] Файл нельзя скачать

#### 12.4 Раздел «Пакетные»

##### 12.4.1 Список пакетов

- [ ] Отображение списка доступных пакетов
- [ ] Пакеты по умолчанию:
  - [ ] "Больше вопросов" (дефолтная цена: 1000 ₸)
  - [ ] "История Казахстана" (дефолтная цена: 1000 ₸)
- [ ] Для каждого пакета отображаются:
  - [ ] Название пакета (редактируемое поле)
  - [ ] Цвет значка пакета (выбор цвета через color picker)
  - [ ] Цена пакета (редактируемое поле, в тенге)
  - [ ] Тумблер Активен / Неактивен
  - [ ] Кнопка «Удалить пакет» (с подтверждением)

##### 12.4.2 Логика активации пакета

- [ ] **Активен:**
  - [ ] Пакет отображается в приложении
  - [ ] Доступен пользователям для покупки
- [ ] **Неактивен:**
  - [ ] Пакет исчезает из магазина в приложении
  - [ ] Пользователи не могут купить пакет
  - [ ] Пользователи, которые купили пакет ранее, сохраняют доступ к вопросам

##### 12.4.3 Управление значком пакета

- [ ] Выбор цвета значка для каждого пакета
- [ ] Значок отображается:
  - [ ] Рядом с названием пакета в приложении
  - [ ] Рядом с вопросом, если он взят из данного пакета

##### 12.4.4 Удаление пакета

- [ ] Кнопка «Удалить пакет» с подтверждением
- [ ] После удаления:
  - [ ] Пакет полностью исчезает из админ-панели
  - [ ] Пакет не используется в игре

##### 12.4.5 Создание нового пакета

- [ ] Кнопка «+» в разделе «Пакетные»
- [ ] При нажатии создается новый пустой пакет:
  - [ ] Название: пустое
  - [ ] Цвет значка: дефолтный
  - [ ] Цена: 1000 тенге (дефолтная)
  - [ ] Статус: активен
- [ ] После создания пакет можно редактировать

##### 12.4.6 Внутренний экран пакета

- [ ] При переходе внутрь конкретного пакета:
  - [ ] Два блока загрузки Excel:
    - [ ] Excel на казахском языке
    - [ ] Excel на русском языке
  - [ ] Для каждого блока:
    - [ ] Кнопка «Загрузить Excel»
    - [ ] Кнопка «Удалить файл»
    - [ ] Индикатор загруженного файла
  - [ ] Файл нельзя скачать
- [ ] Навигация назад к списку пакетов

#### 12.5 Техническая реализация

- [ ] Backend API для админ-панели (Firebase/собственный сервер)
- [ ] Хранение файлов Excel на сервере
- [ ] Синхронизация данных с приложением (Firebase Realtime Database / Cloud Firestore)
- [ ] Система авторизации (Firebase Auth / собственная)
- [ ] Валидация загружаемых Excel файлов
- [ ] Обработка ошибок загрузки
- [ ] UI компоненты для админ-панели:
  - [ ] File picker для загрузки Excel
  - [ ] Color picker для выбора цвета значка
  - [ ] Toggle switch для активации/деактивации
  - [ ] Диалоги подтверждения удаления
  - [ ] Формы редактирования пакетов

#### 12.6 Безопасность

- [ ] Админка доступна только авторизованным пользователям
- [ ] Возможность смены пароля администратора
- [ ] Защита от несанкционированного доступа
- [ ] Валидация прав доступа на сервере

### Этап 13: Полировка UI

- Анимации кнопок
- Переходы между экранами (без задержек)
- Адаптация под разные размеры экранов
- Тестирование на iOS и Android