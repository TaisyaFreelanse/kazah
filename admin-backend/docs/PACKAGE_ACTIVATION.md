# Логика активации пакетов

## Обзор

Пакеты могут быть активными или неактивными. Это позволяет управлять видимостью пакетов в приложении без их удаления.

## Состояния пакета

### Активен (`isActive: true`)

Когда пакет активен:
- ✅ Пакет отображается в магазине приложения
- ✅ Доступен пользователям для покупки
- ✅ Вопросы из пакета доступны после покупки

### Неактивен (`isActive: false`)

Когда пакет неактивен:
- ❌ Пакет **не отображается** в магазине приложения
- ❌ Пользователи **не могут купить** новый пакет
- ✅ Пользователи, которые **купили пакет ранее**, **сохраняют доступ** к вопросам этого пакета

## API Endpoints

### Для админ-панели (требует авторизации)

```
GET /api/packages
```
Возвращает **все** пакеты (активные и неактивные) для управления в админ-панели.

### Для Android приложения (публичный)

```
GET /api/public/packages
```
Возвращает **только активные** пакеты для отображения в магазине приложения.

```
GET /api/public/packages/:id
```
Проверяет доступность конкретного пакета. Возвращает 404, если пакет неактивен.

## Использование в Android приложении

### Получение списка доступных пакетов

```dart
// Получить только активные пакеты для магазина
final response = await http.get(
  Uri.parse('https://blim-bilem-admin-backend.onrender.com/api/public/packages'),
);

final packages = jsonDecode(response.body) as List;
// packages содержит только активные пакеты
```

### Проверка доступности пакета

```dart
// Проверить, доступен ли пакет для покупки
final response = await http.get(
  Uri.parse('https://blim-bilem-admin-backend.onrender.com/api/public/packages/$packageId'),
);

if (response.statusCode == 200) {
  // Пакет активен и доступен
} else if (response.statusCode == 404) {
  // Пакет неактивен или не существует
}
```

### Загрузка вопросов из пакета

**Важно:** При загрузке вопросов из пакетов в игре, нужно проверять:
1. Пакет активен ИЛИ
2. Пользователь купил пакет ранее (проверка через локальное хранилище покупок)

Это позволяет пользователям, которые купили пакет до его деактивации, продолжать использовать вопросы из этого пакета.

## Пример логики в приложении

```dart
Future<List<Package>> getAvailablePackages() async {
  // Получаем только активные пакеты из API
  final response = await http.get(
    Uri.parse('$apiUrl/api/public/packages'),
  );
  
  if (response.statusCode == 200) {
    final List<dynamic> data = jsonDecode(response.body);
    return data.map((json) => Package.fromJson(json)).toList();
  }
  
  return [];
}

Future<List<Question>> loadPackageQuestions(String packageId) async {
  // Проверяем, купил ли пользователь пакет
  final purchasedPackages = await getPurchasedPackages();
  final hasPurchased = purchasedPackages.contains(packageId);
  
  if (!hasPurchased) {
    // Проверяем, активен ли пакет
    final response = await http.get(
      Uri.parse('$apiUrl/api/public/packages/$packageId'),
    );
    
    if (response.statusCode != 200) {
      throw Exception('Пакет недоступен');
    }
  }
  
  // Загружаем вопросы из пакета
  // ...
}
```

## Управление в админ-панели

В админ-панели можно:
1. Видеть все пакеты (активные и неактивные)
2. Переключать статус активности через тумблер
3. Редактировать неактивные пакеты
4. Удалять пакеты (независимо от статуса)

## Важные замечания

1. **Деактивация не удаляет пакет** - пакет остается в базе данных, но скрыт от новых пользователей
2. **Покупки сохраняются** - пользователи, купившие пакет до деактивации, сохраняют доступ
3. **Реактивация** - можно снова активировать пакет, и он снова появится в магазине
4. **Публичный API** - endpoint `/api/public/packages` не требует авторизации и возвращает только активные пакеты

